##### PROJECT IO #####

project:
  name: hic_test
  genome: hg38
  # PEP configuration file
  pep_config: "../pep/project_config_test.yaml"
  read_type: paired

##### WORKFLOW RESOURCES #####

resources:
  mem_mb: 16000
  threads: 8

##### GENOME REFERENCES (HG38) #####
# Paths to static resources (uses placeholders from PEP)

input:
  genome:
    assembly_name: 'hg38'
    fasta: "{database_dir}/hg38/hg38.fa"
    bwa_index_wildcard_path: '/storage/zhangkaiLab/shared/genomes/GRCh38/bwa-mem2/GRCh38'
    bowtie_index_path: "{database_dir}/hg38/indices_for_Bowtie2/hg38"
    chrom_sizes_path: '{database_dir}/hg38/hg38.chromSizes'
  
  # Automatically create library_groups containing all libraries
  all_group: True

##### ALIGNMENT STRATEGY #####

map:
  mapper: 'bwa-mem2'  # Options:  'bwa-mem2', 'bowtie2'
  build_bwa_index: false
  
  # Mapper-specific options
  mapping_options: ''
  
  # Ligation sites (MboI) - can be overridden per-sample in PEP table
  cutsite: 'GATCGATC'
  cutpattern: "^GATC"
  
  # Bowtie2 rescue strategy options
  rescue_options:
    global_extra: '--very-sensitive -L 30 --score-min L,-0.6,-0.2 --end-to-end --reorder'
    local_extra: '--very-sensitive -L 20 --score-min L,-0.6,-0.2 --end-to-end --reorder'
    min_mapq: 10  # For mergeSAM.py
  
  # Adapter trimming with fastp
  trim_options: '--detect_adapter_for_pe -q 15'
  
  use_custom_split: True
  use_stitch_cut: true     # <<< turn on stitch_cut.smk
  stitch_cut:
    min_overlap: 10        # FLASH2 params (optional, defaults already exist)
    max_overlap: 150
    min_ratio: 0.5         # sam2pairs params (optional)
    min_mapq: 10

##### PARSING & PAIR GENERATION #####

parse:
  # Fragment file for restriction enzyme (MboI)
  fragment_file: "{database_dir}/hg38/mboi_fragment.bed"
  
  # Pairsam generation options
  make_pairsam: False
  drop_seq: True
  drop_readid: False
  keep_unparsed_bams: True
  
  # Pairtools parse options
  parsing_options: '--add-columns mapq --walks-policy 5unique'
  
  # Phasing configuration (optional)
  phase:
    do_phase: False
    tag_mode: XA
    suffixes:
      - _cast
      - _129

##### DEDUPLICATION #####

dedup:
  max_mismatch_bp: 0
  save_by_tile_dups: True
  dedup_options: ""

##### SCALING / P(s) CALCULATION #####

scaling_pairs:
  do_scaling: True
  min_distance: 10
  max_distance: False  # Use longest chromosome
  n_dist_bins_decade: 10
  scaling_options: ''

##### BINNING & COOLER GENERATION #####

bin:
  # Multi-resolution cooler resolutions
  resolutions:
    - 10000000
    - 5000000
    - 2500000
    - 1000000
    - 500000
    - 250000
    - 100000
    - 50000
    - 25000
    - 10000
    - 5000
    - 2000
    - 1000
  
  # Resolutions for Mustache loop calling
  resolution_for_mustache:
    - 1000000
    - 500000
    - 250000
    - 100000
    - 50000
    - 25000
    - 10000
    - 5000
    - 2000
  
  # Balance coolers
  balance: True
  
  # Filtering options
  filters:
    mapq_30: '(mapq1>=30) and (mapq2>=30)'
  
  # Convert to .hic format
  make_hic: False

##### OUTPUT DIRECTORIES #####

output_base_dir: '/storage/zhangkaiLab/hanlitian/macrophage/process/20260109_hic_test_stitch'

##### DOWNSTREAM ANALYSIS #####

# Mustache loop detection configuration
mustache:
  executable_path: "workflow/scripts/mustache.py"
  thresholds:
    10000000: "0.1"
    5000000: "0.1"
    2500000: "0.1"
    1000000: "0.1"
    500000: "0.1"
    250000: "0.1"
    100000: "0.1"
    50000: "0.1"
    25000: "0.1"
    10000: "0.1"
    5000: "0.2"
    2000: "0.2"
    1000: "0.2"
  sparse_params:
    10000000: "0.88"
    5000000: "0.88"
    2500000: "0.88"
    1000000: "0.88"
    500000: "0.88"
    250000: "0.88"
    100000: "0.88"
    50000: "0.88"
    25000: "0.88"
    10000: "0.88"
    5000: "0.7"
    2000: "0.7"
    1000: "0.7"

