##### PROJECT IO #####

project:
  name: hic_test
  genome: hg38
  # Output directory (can use {process_dir} placeholder from PEP)
  out_dir: "{process_dir}/20251017_hic_test"
  # PEP configuration file
  pep_config: "../pep/project_config.yaml"
  read_type: paired

##### WORKFLOW RESOURCES #####

resources:
  mem_mb: 16000
  threads: 8

##### GENOME REFERENCES (HG38) #####
# Paths to static resources (uses placeholders from PEP)

input:
  genome:
    assembly_name: 'hg38'
    fasta: "{database_dir}/hg38/hg38.fa"
    bwa_index_wildcard_path: '{database_dir}/hg38/GRCh38.primary_assembly.genome.fa.gz'
    bowtie_index_path: "{database_dir}/hg38/indices_for_Bowtie2/hg38"
    chrom_sizes_path: '{database_dir}/hg38/hg38.chromSizes'
  
  # Automatically create library_groups containing all libraries
  all_group: True

##### ALIGNMENT STRATEGY #####

map:
  mapper: 'bowtie2'  # Options: 'bwa-mem', 'bwa-mem2', 'bwa-meme', 'chromap', 'bowtie2'
  
  # No chunking - process each run as a single unit
  chunksize: 0
  
  # Mapper-specific options
  mapping_options: ''
  
  # Ligation sites (MboI) - can be overridden per-sample in PEP table
  cutsite: 'GATCGATC'
  cutpattern: "^GATC"
  
  # Bowtie2 rescue strategy options
  rescue_options:
    global_extra: '--very-sensitive -L 30 --score-min L,-0.6,-0.2 --end-to-end --reorder'
    local_extra: '--very-sensitive -L 20 --score-min L,-0.6,-0.2 --end-to-end --reorder'
    min_mapq: 10  # For mergeSAM.py
  
  # Adapter trimming with fastp
  trim_options: '--detect_adapter_for_pe -q 15'
  
  use_custom_split: True

##### PARSING & PAIR GENERATION #####

parse:
  # Fragment file for restriction enzyme (MboI)
  fragment_file: "{database_dir}/hg38/mboi_fragment.bed"
  
  # Pairsam generation options
  make_pairsam: False
  drop_seq: True
  drop_readid: False
  keep_unparsed_bams: True
  
  # Pairtools parse options
  parsing_options: '--add-columns mapq --walks-policy 5unique'
  
  # Phasing configuration (optional)
  phase:
    do_phase: False
    tag_mode: XA
    suffixes:
      - _cast
      - _129

##### DEDUPLICATION #####

dedup:
  max_mismatch_bp: 0
  save_by_tile_dups: True
  dedup_options: ""

##### SCALING / P(s) CALCULATION #####

scaling_pairs:
  do_scaling: True
  min_distance: 10
  max_distance: False  # Use longest chromosome
  n_dist_bins_decade: 10
  scaling_options: ''

##### BINNING & COOLER GENERATION #####

bin:
  # Multi-resolution cooler resolutions
  resolutions:
    - 10000000
    - 5000000
    - 2500000
    - 1000000
    - 500000
    - 250000
    - 100000
    - 50000
    - 25000
    - 10000
    - 5000
    - 2000
    - 1000
  
  # Resolutions for Mustache loop calling
  resolution_for_mustache:
    - 1000000
    - 500000
    - 250000
    - 100000
    - 50000
    - 25000
    - 10000
    - 5000
    - 2000
  
  # Balance coolers
  balance: True
  
  # Filtering options
  filters:
    mapq_30: '(mapq1>=30) and (mapq2>=30)'
  
  # Convert to .hic format
  make_hic: False

##### OUTPUT DIRECTORIES #####

output_base_dir: '/storage/zhangkaiLab/hanlitian/macrophage/process/20251212_hic_test'

output:
  dirs:
    downloaded_fastqs: '{output_base_dir}/refs/raw_fastq'
    processed_fastqs: '{output_base_dir}/middle_file/Trimmed_fastq'
    mapped_parsed_sorted_chunks: '{output_base_dir}/Important_processed/Bam'
    pairs_runs: '{output_base_dir}/Important_processed/Track/pairs_runs'
    pairs_library: '{output_base_dir}/Important_processed/Track/pairs_library'
    coolers_library: '{output_base_dir}/Important_processed/Track/coolers_library'
    coolers_library_group: '{output_base_dir}/Important_processed/Track/coolers_library_group'
    stats_library_group: '{output_base_dir}/downstream_res/stats_library_group'
    downstream_dist_folder: '{output_base_dir}/downstream_res/downstream_dist'
    downstream_loops_folder: '{output_base_dir}/Important_processed/Peaks'
    multiqc: '{output_base_dir}/Report'

##### DOWNSTREAM ANALYSIS #####

# Mustache loop detection configuration
mustache:
  executable_path: "workflow/scripts/mustache.py"
  thresholds:
    10000000: "0.1"
    5000000: "0.1"
    2500000: "0.1"
    1000000: "0.1"
    500000: "0.1"
    250000: "0.1"
    100000: "0.1"
    50000: "0.1"
    25000: "0.1"
    10000: "0.1"
    5000: "0.2"
    2000: "0.2"
    1000: "0.2"
  sparse_params:
    10000000: "0.88"
    5000000: "0.88"
    2500000: "0.88"
    1000000: "0.88"
    500000: "0.88"
    250000: "0.88"
    100000: "0.88"
    50000: "0.88"
    25000: "0.88"
    10000: "0.88"
    5000: "0.7"
    2000: "0.7"
    1000: "0.7"

##### EXTERNAL SERVICES #####

# ResGen upload configuration
resgen:
  upload: False
  user: Gilbert
  project: Macrophage_hic_test
